<!doctype html>
<html>
  <head>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Server Rendering Example | Curi Documentation</title>
    <link href="https://fonts.googleapis.com/css?family=Zilla+Slab:300,400" rel="stylesheet">
    <link href="/static/css/index.css" rel="stylesheet">
  </head>
  <body>
    <div id="root"><div data-reactroot=""><header><nav><ul><li><a class="home-link" href="/">Curi</a></li><li><a href="/packages">Packages</a></li><li><a href="/tutorial">Tutorial</a></li><li><a href="/guides">Guides</a></li><li><a class="active" href="/examples">Examples</a></li><li><a href="https://github.com/pshrmn/curi">GitHub</a></li></ul></nav></header><main><div class="example"><div class="content"><h1>Server Rendering</h1><div class="section" id="explanation"><h2>Explanation<a class="header-link" href="/examples/misc/server-rendering/#explanation">#</a></h2><p>Server rendering with Curi is fairly straightforward. You should have a catch all route handler that will respond to all (non-static file) requests.</p><pre><code class="language-javascript">function catchAll(req, res) {
  // 1. Create a memory history using the requested location
  const history = InMemory({ locations: [req.url]});

  // 2. Create a router
  const router = curi(history, routes);

  // 3. Wait for the response to be generated
  router.respond(({ response, navigation }) =&gt; {
    // 4. Generate the HTML markup by rendering a &lt;CuriProvider&gt; and
    // passing it the router.
    const markup = renderToString(
      &lt;CuriProvider router={router}&gt;
        {renderFunction}
      &lt;/CuriProvider&gt;
    );
    // 5. Insert the markup into the page&#x27;s html and send it
    res.send(renderFullPage(markup));
  });
}</code></pre><p>The above example is very basic. Some other things that you might need to consider are:</p><ul><li>Data loading — You would need to maintain two copies of your routes if you want to handle data fetching on the server differently than it works on the client side. This is not something that I have explored very closely yet, so I don&#x27;t have any recommendations on exactly how to approach this.</li><li>Code splitting — In order to use dynamic imports on the server, you will probably need to use a Babel plugin like<!-- --> <code class="language-javascript">dynamic-import-node</code>. Unfortunately,<!-- --> <code class="language-javascript">dynamic-import-node</code> breaks Webpack&#x27;s code splitting. In order for your code to be split into multiple bundles, you should ensure that <code class="language-javascript">dynamic-import-node</code> isn&#x27;t being run when building your client side bundle. The solution used in this experiment is to use the <code class="language-javascript">env</code> property.<pre><code class="language-javascript">{
  &quot;presets&quot;: [ &quot;es2015&quot;, &quot;react&quot; ],
  &quot;plugins&quot;: [
    &quot;syntax-dynamic-import&quot;
  ],
  &quot;env&quot;: {
    &quot;server&quot;: {
      &quot;plugins&quot;: [&quot;dynamic-import-node&quot;]
    }
  }
}</code></pre>Then, when starting the server, make sure that BABEL_ENV=server.<pre><code class="language-markup">cross-env BABEL_ENV=server npm start</code></pre></li></ul></div><div class="section" id="source"><h2>On GitHub<a class="header-link" href="/examples/misc/server-rendering/#source">#</a></h2>If you want to run this code locally, the source code is available on GitHub<!-- --> <a href="https://github.com/pshrmn/curi/tree/master/examples/misc/server-rendering">here</a>.</div></div><div class="sidebar"><h2>Examples</h2><div><div><h3>react</h3><ul class="link-list"><li class="solo"><a href="/examples/react/active-links/">Active Links</a></li><li class="solo"><a href="/examples/react/authentication/">Authentication</a></li><li class="solo"><a href="/examples/react/basic/">Basic</a></li><li class="solo"><a href="/examples/react/blocking-navigation/">Blocking Navigation</a></li><li class="solo"><a href="/examples/react/breadcrumbs/">Breadcrumbs</a></li><li class="solo"><a href="/examples/react/data-loading/">Data Loading</a></li><li class="solo"><a href="/examples/react/modal/">Modal Routes</a></li><li class="solo"><a href="/examples/react/multi-body/">Multiple Body Components</a></li><li class="solo"><a href="/examples/react/mobx/">MobX</a></li><li class="solo"><a href="/examples/react/redux/">Redux</a></li><li class="solo"><a href="/examples/react/transitions/">Transitions</a></li></ul></div><div><h3>vue</h3><ul class="link-list"><li class="solo"><a href="/examples/vue/active-links/">Active Links</a></li><li class="solo"><a href="/examples/vue/authentication/">Authentication</a></li><li class="solo"><a href="/examples/vue/basic/">Basic</a></li><li class="solo"><a href="/examples/vue/breadcrumbs/">Breadcrumbs</a></li><li class="solo"><a href="/examples/vue/blocking-navigation/">Blocking Navigation</a></li><li class="solo"><a href="/examples/vue/modal/">Modal Routes</a></li><li class="solo"><a href="/examples/vue/transitions/">Transitions</a></li></ul></div><div><h3>svelte</h3><ul class="link-list"><li class="solo"><a href="/examples/svelte/basic/">Basic</a></li></ul></div><div><h3>full</h3><ul class="link-list"><li class="solo"><a href="/examples/full/twitch/">Twitch Clone</a></li></ul></div><div><h3>misc</h3><ul class="link-list"><li class="solo"><a href="/examples/misc/code-splitting/">Code Splitting</a></li><li class="solo"><a href="/examples/misc/script-tags/">Script Tags</a></li><li class="solo"><a class="active" href="/examples/misc/server-rendering/">Server Rendering</a></li><li class="solo"><a href="/examples/misc/side-effect/">Side Effects</a></li></ul></div></div></div></div></main></div></div>
    <script src="https://unpkg.com/react@16.0.0/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@16.0.0/umd/react-dom.production.min.js"></script>
    <script src="/static/js/prism.js"></script>
    <script src="/static/js/bundle.js"></script>
  </body>
</html>
