<!doctype html>
<html>
  <head>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Apollo Integration Guide | Curi Documentation</title>
    <link href="https://fonts.googleapis.com/css?family=Zilla+Slab:300,400" rel="stylesheet">
    <link href="/static/css/index.css" rel="stylesheet">
  </head>
  <body>
    <div id="root"><style data-emotion-css="aasxp9-header">.css-aasxp9-header{background:#222233;width:100%;padding:30px 15px;}.css-aasxp9-header nav{color:#efefef;}.css-aasxp9-header nav ul{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-flow:row wrap;-ms-flex-flow:row wrap;flex-flow:row wrap;-webkit-align-items:flex-end;-webkit-box-align:flex-end;-ms-flex-align:flex-end;align-items:flex-end;list-style:none;padding:0;margin:0;}.css-aasxp9-header nav li{padding:0 10px;}.css-aasxp9-header nav a{color:#efefef;font-size:1.1em;-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:50px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-bottom:1px solid #222233;}.css-aasxp9-header nav a:hover{color:#ff9800;}.css-aasxp9-header nav a.active{color:#ff9800;border-bottom-color:#ff9800;}.css-aasxp9-header .home-link{font-size:1.5em;color:#ff9800;}@media only screen and (min-width:641px){.css-aasxp9-header{padding:0;position:fixed;z-index:1;}.css-aasxp9-header nav ul{max-width:100%;}.css-aasxp9-header nav ul li{margin-right:20px;padding:0;}.css-aasxp9-header nav a{border-bottom-width:3px;padding:0 5px;}}</style><header class="css-aasxp9-header"><nav><ul><li><a class="home-link " href="/">Curi</a></li><li><a class=" " href="/packages">Packages</a></li><li><a class=" " href="/guides/getting-started/">Guides</a></li><li><a class=" " href="/tutorial">Tutorials</a></li><li><a class=" " href="/examples">Examples</a></li><li><a href="https://github.com/pshrmn/curi">GitHub</a></li></ul></nav></header><style data-emotion-css="x6k3qt-main">.css-x6k3qt-main{width:calc(100vw - 20px);padding:10px 10px 0;margin-bottom:20px;}.css-x6k3qt-main a{color:#222233;}@media only screen and (min-width:641px){.css-x6k3qt-main{padding:50px 25px 0;}}</style><main class="css-x6k3qt-main"><style data-emotion-css="jb12jd-page">.css-jb12jd-page{position:relative;}@media only screen and (min-width:641px){.css-jb12jd-page{padding-top:15px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-flow:row-nowrap;-ms-flex-flow:row-nowrap;flex-flow:row-nowrap;}}</style><div class="css-jb12jd-page guide"><style data-emotion-css="1oop4xp-content">.css-1oop4xp-content ul{padding:0;list-style:none;}@media only screen and (min-width:641px){.css-1oop4xp-content{-webkit-order:2;-ms-flex-order:2;order:2;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;position:relative;padding:0 50px;}}</style><div class="css-1oop4xp-content"><h1>Apollo Integration</h1><style data-emotion-css="1kutd5m-sidebySide">.css-1kutd5m-sidebySide{margin:10px 0 20px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-flow:row wrap;-ms-flex-flow:row wrap;flex-flow:row wrap;-webkit-box-pack:start;-webkit-justify-content:flex-start;-ms-flex-pack:start;justify-content:flex-start;}@media only screen and (min-width:641px){.css-1kutd5m-sidebySide > :first-child{margin-right:20px;}}</style><div class="css-1kutd5m-sidebySide"><style data-emotion-css="18ghg7h-explanation">.css-18ghg7h-explanation{width:100%;}.css-18ghg7h-explanation p{margin:0 0 25px;}@media only screen and (min-width:641px){.css-18ghg7h-explanation{-webkit-flex:1 1 50%;-ms-flex:1 1 50%;flex:1 1 50%;max-width:600px;}}</style><div class="css-18ghg7h-explanation"><p><a href="https://apollographql.com">Apollo</a> is a great solution for managing an application&#x27;s data using<!-- --> <a href="http://graphql.org">GraphQL</a>.</p><p>There are a few different implementation strategies for integrating Apollo and Curi based on how tightly you want them to be paired.</p><style data-emotion-css="12hcwfb-note">.css-12hcwfb-note{padding:10px 5px;margin:5px 0;background:#eeeeee;border:1px solid #c7c7c7;}.css-12hcwfb-note:not(pre) > code[class*="language-"]{background:#fff;}.aside .css-12hcwfb-note{background:#fff;}</style><div class="css-12hcwfb-note"><strong>Note:</strong> <p>This guide only covers integration between Curi and Apollo. If you are not already familiar with how to use Apollo, you will want to learn that first.</p><p>Also, this guide will only be referencing Apollo&#x27;s React implementation, but the principles are the same no matter how you render your application.</p></div></div></div><style data-emotion-css="1ten54b-section">.css-1ten54b-section.section,.css-1ten54b-section.subsection{margin-top:15px;}.css-1ten54b-section.section .header-link,.css-1ten54b-section.subsection .header-link{margin-left:10px;-webkit-text-decoration:none;text-decoration:none;color:#666;}.css-1ten54b-section.aside{padding:5px 10px;border-left:2px solid #4caf50;background:#e8f5e9;margin-top:15px;}.css-1ten54b-section.aside .header-link{margin-left:10px;-webkit-text-decoration:none;text-decoration:none;color:#666;}.css-1ten54b-section.aside:not(pre) > code[class*="language-"]{background:#81c784;}</style><div class="css-1ten54b-section section" id="setup"><h2>Setup<a class="header-link" href="/guides/apollo/#setup">#</a></h2><div class="css-1kutd5m-sidebySide"><div class="css-18ghg7h-explanation"><p>Your application&#x27;s Apollo client instance should be defined in its own module so that it can be imported throughout the application.</p></div><style data-emotion-css="18z6812-codeBlock">.css-18z6812-codeBlock{width:100%;}.css-18z6812-codeBlock pre{height:100%;vertical-align:top;}@media only screen and (min-width:641px){.css-18z6812-codeBlock{-webkit-flex:1 0 50%;-ms-flex:1 0 50%;flex:1 0 50%;}.css-18z6812-codeBlock code{min-width:200px;}}</style><div class="css-18z6812-codeBlock"><pre><code class="language-javascript">// apollo.js
import ApolloClient from &quot;apollo-boost&quot;;

export default ApolloClient({
  uri: &quot;https://example.com/graphql&quot;
});</code></pre></div></div><div class="css-1kutd5m-sidebySide"><div class="css-18ghg7h-explanation"><p>Apollo&#x27;s React package provides an <code class="language-jsx">&lt;<!-- -->ApolloProvider<!-- -->&gt;</code> <!-- -->component for accessing your Apollo client throughout the application. The <code class="language-jsx">&lt;<!-- -->CuriProvider<!-- -->&gt;</code> should be a descendant of the <code class="language-jsx">&lt;<!-- -->ApolloProvider<!-- -->&gt;</code> because we don&#x27;t need to re-render the<!-- --> <code class="language-jsx">&lt;<!-- -->ApolloProvider<!-- -->&gt;</code> for every new response.</p></div><div class="css-18z6812-codeBlock"><pre><code class="language-jsx">import { ApolloProvider } from &quot;react-apollo&quot;;
import { CuriProvider } from &quot;@curi/react&quot;;

ReactDOM.render((
  &lt;ApolloProvider client={client}&gt;
    &lt;CuriProvider router={router}&gt;
      {() =&gt; {...}}
    &lt;/CuriProvider&gt;
  &lt;/ApolloProvider&gt;
), holder);</code></pre></div></div></div><div class="css-1ten54b-section section" id="loose-pairing"><h2>Loose Pairing<a class="header-link" href="/guides/apollo/#loose-pairing">#</a></h2><div class="css-1kutd5m-sidebySide"><div class="css-18ghg7h-explanation"><p>Apollo and Curi don&#x27;t actually have to know about each other. Curi can create a response without doing any data fetching and let Apollo handle that with its <code class="language-jsx">&lt;<!-- -->Query<!-- -->&gt;</code> component.</p></div><div class="css-18z6812-codeBlock"><pre><code class="language-javascript">// routes.js
import Noun from &quot;./pages/Noun&quot;;

// nothing Apollo related in here
const routes = [
  {
    name: &#x27;Noun&#x27;,
    path: &#x27;noun/:word&#x27;,
    response: () =&gt; {
      return {
        body: Noun
      };
    }
  }
];</code></pre></div></div><div class="css-1kutd5m-sidebySide"><div class="css-18ghg7h-explanation"><p>Any location data that a query needs can be taken from the response object. The best way to access this from your components would be to pass the <code class="language-javascript">response</code> to the components rendered in the<!-- --> <code class="language-jsx">&lt;<!-- -->CuriProvider<!-- -->&gt;</code>&#x27;s render-invoked <code class="language-javascript">children</code> prop.</p></div><div class="css-18z6812-codeBlock"><pre><code class="language-jsx">// index.js
ReactDOM.render((
  &lt;ApolloProvider client={client}&gt;
    &lt;CuriProvider router={router}&gt;
      {({ response }) =&gt; {
        const { body:Body } = response;
        return &lt;Body response={response} /&gt;;
      }}
    &lt;/CuriProvider&gt;
  &lt;/ApolloProvider&gt;
), holder);</code></pre></div></div><div class="css-1kutd5m-sidebySide"><div class="css-18ghg7h-explanation"><p>Because we pass the <code class="language-javascript">response</code> to the route&#x27;s<!-- --> <code class="language-javascript">body</code> component, we can pass a <code class="language-jsx">&lt;<!-- -->Query<!-- -->&gt;</code> the response&#x27;s location params using <code class="language-javascript">props.response.params</code>.</p></div><div class="css-18z6812-codeBlock"><pre><code class="language-jsx">// pages/Nouns.js
import { Query } from &quot;react-apollo&quot;;

const GET_NOUN = gql`
  query noun($word: String!) {
    noun(word: $word) {
      word,
      type,
      definition
    }
  }
`;

// use the &quot;word&quot; param from the response props
// to query the correct data
const Noun = ({ response }) =&gt; (
  &lt;Query
    query={GET_NOUN}
    variables={{ word: response.params.word }}
  &gt;
    {({ loading, error, data }) =&gt; {
      if (loading) {
        return &lt;Loading /&gt;;
      }
      // ...

      return (
        &lt;div&gt;
          &lt;h1&gt;{data.noun.word}&lt;/h1&gt;
          &lt;p&gt;{data.noun.definition}&lt;/p&gt;
        &lt;/div&gt;
      )
    }}
  &lt;/Query&gt;
);</code></pre></div></div></div><div class="css-1ten54b-section section" id="tight-pairing"><h2>Tight Pairing<a class="header-link" href="/guides/apollo/#tight-pairing">#</a></h2><div class="css-1kutd5m-sidebySide"><div class="css-18ghg7h-explanation"><p>You can use your Apollo client instance to call queries in a route&#x27;s<!-- --> <code class="language-javascript">on.every()</code> function. <code class="language-javascript">on.every()</code> is expected to return a Promise, which is exactly what <code class="language-javascript">client.query()</code> <!-- -->returns, so tightly pairing Curi and Apollo is mostly center around using <code class="language-javascript">on.every()</code> to return a <code class="language-javascript">client.query()</code> <!-- -->call. This will delay navigation until after a route&#x27;s GraphQL data has been loaded by Apollo.</p></div><div class="css-18z6812-codeBlock"><pre><code class="language-javascript">import client from &quot;./apollo&quot;;
import { EXAMPLE_QUERY } from &quot;./queries&quot;;

const routes = [
  {
    name: &quot;Example&quot;,
    path: &quot;example/:id&quot;,
    on: {
      every({ params }) {
        return client.query({
          query: EXAMPLE_QUERY,
          variables: { id: params.id }
        });
      }
    }
  }
];</code></pre></div></div><div class="css-1kutd5m-sidebySide"><div class="css-18ghg7h-explanation"><p>There are two strategies for doing this. Both approaches require you to be able to import your Apollo client in the module where you define your routes, which is why we created client in its own module in the <a href="/guides/apollo/#setup">setup</a> section.</p></div><div class="css-18z6812-codeBlock"><pre><code class="language-javascript">// index.js
import client from &quot;./apollo&quot;;

ReactDOM.render((
  &lt;ApolloProvider client={client}&gt;
    /*...*/
  &lt;/ApolloProvider&gt;
), holder);

// routes.js
import client from &quot;./apollo&quot;;

// ...</code></pre></div></div><div class="css-1kutd5m-sidebySide"><div class="css-18ghg7h-explanation"><p>The first approach is to avoid the <code class="language-jsx">&lt;<!-- -->Query<!-- -->&gt;</code> altogether. Instead, you can use a route&#x27;s <code class="language-javascript">response()</code> property to attach the data fetched by Apollo directly to a response through its<!-- --> <code class="language-javascript">data</code> property.</p><p>While we know at this point that the query has executed, we should also check <code class="language-javascript">resolved.error</code> in the <code class="language-javascript">response()</code> <!-- -->function to ensure that the query was executed successfully.</p></div><div class="css-18z6812-codeBlock"><pre><code class="language-javascript">// routes.js
import client from &quot;./apollo&quot;;
import GET_VERB from &quot;./queries&quot;;

import Verb from &quot;./pages/Verb&quot;;

export default [
  {
    name: &quot;Verb&quot;,
    path: &quot;verb/:word&quot;,
    on: {
      every({ params }) {
        return client.query({
          query: GET_VERB,
          variables: { word: params.word }
        })
      }
    },
    response({ resolved }) {
      if (resolved.error) {
        // handle failed queries
      }
      return {
        body: Verb,
        data: resolved.every.data
      }
    }
  }
];</code></pre></div></div><div class="css-1kutd5m-sidebySide"><div class="css-18ghg7h-explanation"><p>In the response&#x27;s <code class="language-javascript">body</code> component, you would access the query data through the <code class="language-javascript">response</code>&#x27;s <code class="language-javascript">data</code> <!-- -->property.</p></div><div class="css-18z6812-codeBlock"><pre><code class="language-jsx">// pages/Verb.js
const Verb = ({ response }) =&gt; (
  &lt;div&gt;
    &lt;h1&gt;{response.data.verb.word}&lt;/h1&gt;
    &lt;p&gt;
      {response.data.verb.definition}
    &lt;/p&gt;
  &lt;/div&gt;
)</code></pre></div></div><div class="css-1kutd5m-sidebySide"><div class="css-18ghg7h-explanation"><p>The second approach is to use <code class="language-javascript">on.every()</code> as a way to cache the data, but also use <code class="language-jsx">&lt;<!-- -->Query<!-- -->&gt;</code>. With this approach, we do not have to attach the query data to the response; we are just relying on the fact that Apollo will execute and cache the results prior to navigation.</p></div><div class="css-18z6812-codeBlock"><pre><code class="language-javascript">// routes.js
import client from &quot;./apollo&quot;;
import { GET_VERB } from &quot;./queries&quot;;

export default [
  {
    name: &quot;Verb&quot;,
    path: &quot;verb/:word&quot;,
    on: {
      every({ params }) {
        // load the data so it is cached by
        // your Apollo client
        return client.query({
          query: GET_VERB,
          variables: { word: params.word }
        })
      }
    }
  }
];</code></pre></div></div><div class="css-1kutd5m-sidebySide"><div class="css-18ghg7h-explanation"><p>The route&#x27;s component will render a <code class="language-jsx">&lt;<!-- -->Query<!-- -->&gt;</code> to also call the query. Because the query has already been executed, Apollo will grab the data from its cache instead of re-sending a request to your server.</p></div><div class="css-18z6812-codeBlock"><pre><code class="language-jsx">// pages/Verb.js
import { GET_VERB } from &quot;../queries&quot;;

const Verb = ({ response }) =&gt; (
  &lt;Query
    query={GET_VERB}
    variables={{ word: response.params.word }}
  &gt;
    {({ loading, error, data }) =&gt; {
      // ...
      return (
        &lt;div&gt;
          &lt;h1&gt;{data.verb.word}&lt;/h1&gt;
          &lt;p&gt;
            {data.verb.definition}
          &lt;/p&gt;
        &lt;/div&gt;
      );
    }}
  &lt;/Query&gt;
)</code></pre></div></div><div class="css-1ten54b-section subsection" id="prefetch"><h3>Prefetching<a class="header-link" href="/guides/apollo/#prefetch">#</a></h3><div class="css-1kutd5m-sidebySide"><div class="css-18ghg7h-explanation"><p>One additional benefit of adding queries to routes using<!-- --> <code class="language-javascript">on.every()</code> is that you can prefetch data for a route.</p><p>The<!-- --> <a href="/packages/@curi/route-prefetch/"><code class="language-javascript">@curi/route-prefetch</code></a> <!-- -->interaction lets you programmatically fetch the data for a route prior to navigating to a location.</p></div><div class="css-18z6812-codeBlock"><pre><code class="language-javascript">// index.js
import prefetch from &quot;@curi/route-prefetch&quot;;

const routes = [
  {
    name: &quot;Example&quot;,
    path: &quot;example/:id&quot;,
    on: {
      every({ params }) {
        client.query({
          query: GET_EXAMPLES,
          variables: { id: params.id }
        })
      }
    }
  }
]

const router = curi(history, routes, {
  route: [prefetch()]
});

// this will call the GET_EXAMPLES query
// and Apollo will cache the results
router.route.prefetch(
  &quot;Example&quot;,
  { params: { id: 2 }}
);</code></pre></div></div><div class="css-1kutd5m-sidebySide"><div class="css-18ghg7h-explanation"><p><a href="/packages/@curi/react%20/"><code class="language-javascript">@curi/react</code></a> <!-- -->provides a <code class="language-jsx">&lt;<!-- -->Prefetch<!-- -->&gt;</code> component that will automatically prefetch the data for a route once an element becomes visible in the page.</p><p><code class="language-jsx">&lt;<!-- -->Prefetch<!-- -->&gt;</code> relies on you attaching a <code class="language-javascript">ref</code> to the element that should trigger prefetching. This uses the<!-- --> <a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver"><code class="language-javascript">IntersectionObserver</code></a> <!-- -->API to observe the element you attach the ref to.</p><p>Prefetching behavior can also be attached to other events, such as hovering over an element, but <code class="language-jsx">&lt;<!-- -->Prefetch<!-- -->&gt;</code> is specifically meant for prefetching when an element becomes visible.</p></div><div class="css-18z6812-codeBlock"><pre><code class="language-jsx">import { Prefetch, Link } from &quot;@curi/react&quot;;
            
// don&#x27;t forget to attach the ref to a component!
const PrefetchLink = ({ to, params, ...rest }) =&gt; (
  &lt;Prefetch match={{ name: to, params }}&gt;
    {ref =&gt; (
      &lt;Link to={to} params={params} ref={ref} {...rest} /&gt;
    )}
  &lt;/Prefetch&gt;
);

// usage
&lt;PrefetchLink to=&quot;Example&quot; params={{ id: 3 }}&gt;
  Example 3
&lt;/Prefetch&gt;</code></pre></div></div><div class="css-1kutd5m-sidebySide"><div class="css-18ghg7h-explanation"><p>If you want to get really fancy, <code class="language-jsx">&lt;<!-- -->Prefetch<!-- -->&gt;</code> also lets you access the prefetched data with the second argument to its render-invoked <code class="language-javascript">children</code> prop. You can use this to update your UI to indicate that the data has loaded or even use the loaded data with some filler content.</p></div><div class="css-18z6812-codeBlock"><pre><code class="language-jsx">const PrefetchLink = ({ to, params, children, ...rest }) =&gt; (
  &lt;Prefetch match={{ name: to, params }}&gt;
    {(ref, resolved) =&gt; (
      &lt;Link to={to} params={params} ref={ref} {...rest}&gt;
        {children}
        {resolved ? &lt;Loading /&gt; : &lt;Loaded /&gt;}
      &lt;/Link&gt;
    )}
  &lt;/Prefetch&gt;
);</code></pre></div></div></div></div></div><style data-emotion-css="36dilg-pageLinks">.css-36dilg-pageLinks ul{margin:3px 0;padding-left:0px;list-style:none;}.css-36dilg-pageLinks li{margin:3px 0;}.css-36dilg-pageLinks a{-webkit-text-decoration:none;text-decoration:none;}.css-36dilg-pageLinks h3{border-bottom:1px solid #666;}.css-36dilg-pageLinks .active{font-weight:bold;}.css-36dilg-pageLinks .link-group{margin-bottom:15px;}.css-36dilg-pageLinks .link-list li.with{margin:10px 0;}.css-36dilg-pageLinks .link-list p{margin:0;}.css-36dilg-pageLinks button.toggler{position:fixed;right:5px;bottom:5px;width:75px;height:75px;border-radius:40px;border:0;background:#ff9800;font-size:1em;z-index:1;}.css-36dilg-pageLinks .children{display:none;background:#efefef;padding:10px;}.css-36dilg-pageLinks .children.visible{display:block;position:fixed;top:0;bottom:0;left:0;right:0;overflow-y:scroll;}@media only screen and (min-width:641px){.css-36dilg-pageLinks{position:relative;width:200px;min-width:200px;margin-right:15px;-webkit-order:1;-ms-flex-order:1;order:1;}.css-36dilg-pageLinks h3{font-size:1.1em;}.css-36dilg-pageLinks button.toggler{display:none;}.css-36dilg-pageLinks .children{display:block;background:transparent;}}</style><div class="css-36dilg-pageLinks"><button type="button" class="toggler">Menu</button><div class="children"><h2>Guides</h2><ul><li class="link-group"><h3>basic</h3><ul class="link-list"><li class="solo"><a class=" " href="/guides/installation/">Installation</a></li><li class="solo"><a class=" " href="/guides/getting-started/">Getting Started</a></li><li class="solo"><a class=" " href="/guides/sync-or-async/">Sync or Async</a></li><li class="solo"><a class=" " href="/guides/routes/">Routes</a></li><li class="solo"><a class=" " href="/guides/responses/">Responses</a></li><li class="solo"><a class=" " href="/guides/observers/">Observers</a></li><li class="solo"><a class=" " href="/guides/navigation-objects/">Navigation Objects</a></li></ul></li><li class="link-group"><h3>advanced</h3><ul class="link-list"><li class="solo"><a class=" " href="/guides/route-interactions/">Route Interactions</a></li><li class="solo"><a class=" " href="/guides/side-effects/">Side Effects</a></li><li class="solo"><a class=" " href="/guides/code-splitting/">Code Splitting</a></li><li class="solo"><a class=" " href="/guides/loading/">Loading Route Data</a></li><li class="solo"><a class=" " href="/guides/react-native/">React Native Tips</a></li><li class="solo"><a class=" active" href="/guides/apollo/">Apollo Integration</a></li></ul></li><li class="link-group"><h3>migration</h3><ul class="link-list"><li class="solo"><a class=" " href="/guides/migrate-rrv3/">React Router v2/3</a></li><li class="solo"><a class=" " href="/guides/migrate-rrv4/">React Router v4</a></li></ul></li></ul></div></div></div></main></div>
    <script src="https://unpkg.com/react@16.3.2/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@16.3.2/umd/react-dom.production.min.js"></script>
    <script src="/static/js/prism.js"></script>
    <script src="/static/js/bundle.js"></script>
  </body>
</html>
